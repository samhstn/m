#!/usr/bin/env zunit

@setup {
  source ./m.zsh
  source ./test_helper.zsh
  M_TEST=true
}

@test 'mr - without a previously run m or mo commands' {
  M_HISTORY_TEST='ls'

  run mr

  assert $state equals 1
  assert "$output" same_as "cannot find recently run m or mo commands"
}

@test 'mr - with previous m command' {
  M_HISTORY_TEST='ls\nm file.txt'

  mr

  sleep 0.2

  run m_called_with

  assert "$output" same_as "file.txt"
}

@test 'mr - with previous mg command' {
  cd fixtures/basic

  M_HISTORY_TEST='mo 1\nmg three'

  mr

  sleep 0.2

  run m_called_with

  assert ${#lines} equals 2
  assert ${lines[1]} same_as "cases.txt"
  assert ${lines[2]} same_as "+1"
}
